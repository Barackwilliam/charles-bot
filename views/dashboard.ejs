<!--views/Dashboard.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <style>
        /* ===== BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --primary-light: #e0e7ff;
            --secondary: #7209b7;
            --secondary-light: #f3e8ff;
            --success: #10b981;
            --success-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --info: #3b82f6;
            --info-light: #dbeafe;
            --dark: #1f2937;
            --dark-light: #374151;
            --light: #f8fafc;
            --gray: #6b7280;
            --gray-light: #9ca3af;
            --gray-lighter: #e5e7eb;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --transition: all 0.3s ease;
            --gradient-1: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --gradient-2: linear-gradient(135deg, #7209b7 0%, #4361ee 100%);
            --gradient-3: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-4: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --gradient-gold: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--dark);
            min-height: 100vh;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== HEADER STYLES ===== */
        .main-header {
            background: var(--gradient-1);
            border-radius: var(--radius);
            padding: 24px 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            color: var(--white);
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.1;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .academy-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.5px;
        }

        .academy-subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .live-badge {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { 
                transform: scale(1);
                opacity: 1; 
            }
            50% { 
                transform: scale(1.2);
                opacity: 0.7; 
            }
            100% { 
                transform: scale(1);
                opacity: 1; 
            }
        }

        .time-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            opacity: 0.9;
        }

        /* ===== PDF SECTION STYLES ===== */
        .pdf-section {
            background: var(--white);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .pdf-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: var(--gradient-1);
            opacity: 0.05;
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .pdf-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark);
            font-size: 20px;
        }

        .pdf-header h3 i {
            color: var(--primary);
            font-size: 24px;
        }

        .pdf-actions {
            display: flex;
            gap: 12px;
        }

        .btn-pdf {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            text-decoration: none;
            font-size: 14px;
            box-shadow: var(--shadow);
        }

        .btn-pdf:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-pdf:active {
            transform: translateY(0);
        }

        .btn-pdf.secondary {
            background: var(--success);
        }

        .btn-pdf.secondary:hover {
            background: #0da271;
        }

        .pdf-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        .pdf-option {
            background: var(--light);
            padding: 20px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-lighter);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .pdf-option:hover {
            background: var(--white);
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .pdf-option:hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-1);
        }

        .pdf-option.active {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .pdf-option-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            margin-bottom: 16px;
            font-size: 20px;
        }

        .pdf-option h4 {
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 16px;
            font-weight: 600;
        }

        .pdf-option p {
            font-size: 14px;
            color: var(--gray);
            line-height: 1.5;
        }

        /* ===== SEARCH SECTION ===== */
        .search-section {
            margin-bottom: 32px;
        }

        .search-wrapper {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .modern-input {
            width: 100%;
            padding: 16px 24px 16px 52px;
            border: 2px solid var(--gray-lighter);
            border-radius: var(--radius);
            font-size: 16px;
            transition: var(--transition);
            background: var(--white);
            box-shadow: var(--shadow);
            color: var(--dark);
        }

        .modern-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .modern-input::placeholder {
            color: var(--gray-light);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 18px;
        }

        .search-hint {
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 14px;
            padding-left: 52px;
        }

        /* ===== STATS SECTION ===== */
        .stats-section {
            margin-bottom: 32px;
        }

        .section-header {
            margin-bottom: 24px;
        }

        .section-header h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-subtitle {
            color: var(--gray);
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .gradient-1::before { background: var(--gradient-1); }
        .gradient-2::before { background: var(--gradient-2); }
        .gradient-3::before { background: var(--gradient-3); }
        .gradient-4::before { background: var(--gradient-4); }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--white);
            flex-shrink: 0;
        }

        .gradient-1 .stat-icon { background: var(--gradient-1); }
        .gradient-2 .stat-icon { background: var(--gradient-2); }
        .gradient-3 .stat-icon { background: var(--gradient-3); }
        .gradient-4 .stat-icon { background: var(--gradient-4); }

        .stat-content {
            flex: 1;
        }

        .stat-content h3 {
            font-size: 14px;
            color: var(--gray);
            font-weight: 500;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin: 4px 0;
            color: var(--dark);
        }

        .stat-desc {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 6px;
            background: var(--gray-lighter);
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-4);
            border-radius: 3px;
            transition: width 1s ease;
        }

        /* ===== RESULTS SECTION ===== */
        .results-section {
            background: var(--white);
            border-radius: var(--radius);
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 32px;
        }

        .section-title-group {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .badge {
            background: var(--primary);
            color: var(--white);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .section-actions {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 16px;
        }

        .btn-refresh {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .btn-refresh:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-download-exam {
            background: var(--success);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
            font-size: 14px;
            text-decoration: none;
            box-shadow: var(--shadow);
        }

        .btn-download-exam:hover {
            background: #0da271;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 14px;
        }

        /* ===== TABLE STYLES ===== */
        .table-responsive {
            overflow-x: auto;
            margin-top: 24px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-lighter);
        }

        .modern-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1200px;
        }

        .modern-table thead {
            background: var(--light);
        }

        .modern-table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--gray-lighter);
            white-space: nowrap;
            font-size: 14px;
        }

        .table-header-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modern-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-lighter);
            vertical-align: middle;
        }

        .table-row {
            transition: var(--transition);
        }

        .table-row:hover {
            background: var(--light);
        }

        .table-row.even {
            background: #fafafa;
        }

        .student-link {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--dark);
            transition: var(--transition);
        }

        .student-link:hover {
            color: var(--primary);
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 18px;
            flex-shrink: 0;
        }

        .student-info {
            flex: 1;
        }

        .student-info strong {
            display: block;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .student-info small {
            color: var(--gray);
            font-size: 12px;
            display: block;
        }

        .reg-number {
            background: var(--light);
            padding: 6px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: var(--dark);
            display: inline-block;
        }

        .course-badge {
            background: var(--primary-light);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            display: inline-block;
        }

        .score-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            color: var(--white);
            flex-shrink: 0;
            box-shadow: var(--shadow);
        }

        .score-high { 
            background: var(--success);
            border: 3px solid var(--success-light);
        }
        .score-medium { 
            background: var(--warning);
            border: 3px solid var(--warning-light);
        }
        .score-low { 
            background: var(--danger);
            border: 3px solid var(--danger-light);
        }

        .score-detail {
            font-size: 13px;
            color: var(--gray);
        }

        .time-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark);
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-passed {
            background: var(--success-light);
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .status-failed {
            background: var(--danger-light);
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .date-cell {
            color: var(--dark);
            font-weight: 500;
            font-size: 14px;
        }

        .exam-actions {
            display: flex;
            gap: 8px;
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            padding: 80px 20px;
            text-align: center;
        }

        .empty-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .empty-content h3 {
            margin: 24px 0 12px;
            color: var(--dark);
            font-size: 20px;
        }

        .empty-content p {
            color: var(--gray);
            font-size: 14px;
            line-height: 1.6;
        }

        /* ===== FOOTER ===== */
        .modern-footer {
            background: var(--dark);
            color: var(--white);
            border-radius: var(--radius);
            padding: 32px;
            margin-top: 32px;
            box-shadow: var(--shadow);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 24px;
        }

        .footer-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 18px;
        }

        .footer-text {
            opacity: 0.8;
            font-size: 14px;
            max-width: 400px;
        }

        .footer-right {
            text-align: right;
        }

        .footer-links {
            display: flex;
            gap: 24px;
            margin-bottom: 12px;
        }

        .footer-link {
            color: var(--white);
            text-decoration: none;
            opacity: 0.8;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .footer-link:hover {
            opacity: 1;
            color: var(--primary-light);
        }

        .footer-update {
            opacity: 0.8;
            font-size: 14px;
        }

        .refresh-link {
            color: var(--white);
            text-decoration: none;
            font-weight: 600;
            margin-left: 8px;
            transition: var(--transition);
        }

        .refresh-link:hover {
            color: var(--primary-light);
            text-decoration: underline;
        }

        /* ===== PDF TEMPLATE STYLES ===== */
        .pdf-template {
            display: none;
            position: absolute;
            left: -9999px;
        }

        .exam-pdf-content {
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            padding: 20mm;
            background: var(--white);
            font-family: 'Inter', sans-serif;
            color: var(--dark);
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary);
        }

        .pdf-header h1 {
            color: var(--primary);
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .pdf-header h2 {
            color: var(--secondary);
            font-size: 24px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .pdf-header p {
            color: var(--gray);
            font-size: 16px;
        }

        .pdf-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--light);
            border-radius: 8px;
            border: 1px solid var(--gray-lighter);
        }

        .pdf-detail-item {
            margin-bottom: 10px;
        }

        .pdf-detail-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .pdf-detail-item span {
            color: var(--dark);
            font-size: 15px;
        }

        .pdf-performance {
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .pdf-performance h3 {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 18px;
        }

        .pdf-performance p {
            color: var(--gray);
            line-height: 1.6;
        }

        .pdf-warning {
            background: var(--warning-light);
            border: 1px solid var(--warning);
            padding: 12px;
            border-radius: 6px;
            margin: 20px 0;
            font-size: 13px;
            color: var(--dark);
        }

        .pdf-footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-lighter);
            color: var(--gray);
            font-size: 12px;
            line-height: 1.8;
        }

        /* ===== PDF LOADING OVERLAY ===== */
        .pdf-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(4px);
        }

        .pdf-loading.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
            padding: 40px;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--gray-lighter);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--dark);
            font-size: 16px;
            font-weight: 600;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .main-header {
                padding: 20px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .logo-section {
                flex-direction: column;
                text-align: center;
                gap: 12px;
            }
            
            .pdf-actions {
                flex-direction: column;
                width: 100%;
            }
            
            .btn-pdf {
                width: 100%;
                justify-content: center;
            }
            
            .pdf-options {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .results-section {
                padding: 20px;
            }
            
            .section-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn-refresh {
                justify-content: center;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .footer-right {
                text-align: center;
            }
            
            .footer-links {
                justify-content: center;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .modern-table th,
            .modern-table td {
                padding: 12px 8px;
                font-size: 13px;
            }
            
            .score-circle {
                width: 50px;
                height: 50px;
                font-size: 14px;
            }
            
            .exam-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .pdf-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .academy-title {
                font-size: 20px;
            }
            
            .pdf-header h3 {
                font-size: 18px;
            }
            
            .stat-card {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .stat-icon {
                width: 56px;
                height: 56px;
                font-size: 24px;
            }
            
            .student-link {
                flex-direction: column;
                text-align: center;
                gap: 8px;
            }
            
            .score-container {
                flex-direction: column;
                gap: 8px;
                align-items: center;
            }
            
            .section-title-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .badge {
                align-self: flex-start;
            }
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .exam-pdf-content, .exam-pdf-content * {
                visibility: visible;
            }
            
            .exam-pdf-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            
            .no-print {
                display: none !important;
            }
        }

        /* ===== CUSTOM SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray);
        }

        /* ===== ACCESSIBILITY ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header with gradient -->
        <header class="main-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div>
                        <h1 class="academy-title">Charles Academy</h1>
                        <p class="academy-subtitle">Exam Performance Dashboard</p>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="live-badge">
                        <span class="live-dot"></span>
                        <span>LIVE</span>
                    </div>
                    <div class="time-display">
                        <i class="far fa-clock"></i>
                        <span><%= currentTime %></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- PDF Download Section -->
        <section class="pdf-section">
            <div class="pdf-header">
                <h3><i class="fas fa-file-pdf"></i> Download Exam PDFs</h3>
                <div class="pdf-actions">
                    <button class="btn-pdf" onclick="downloadAllResultsPDF()">
                        <i class="fas fa-download"></i> All Results PDF
                    </button>
                    <button class="btn-pdf secondary" onclick="downloadExamPaperPDF()">
                        <i class="fas fa-file-alt"></i> Exam Paper PDF
                    </button>
                </div>
            </div>
            
            <div class="pdf-options">
                <div class="pdf-option" onclick="generateResultsPDF()">
                    <div class="pdf-option-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h4>Results Report</h4>
                    <p>Generate PDF report of all exam results</p>
                </div>
                
                <div class="pdf-option" onclick="generateCertificatePDF()">
                    <div class="pdf-option-icon">
                        <i class="fas fa-award"></i>
                    </div>
                    <h4>Certificate</h4>
                    <p>Generate certificate for top students</p>
                </div>
                
                <div class="pdf-option" onclick="generateQuestionsPDF()">
                    <div class="pdf-option-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <h4>Question Bank</h4>
                    <p>Download exam questions with answers</p>
                </div>
            </div>
        </section>

        <!-- Search Section -->
        <section class="search-section">
            <div class="search-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" placeholder="Search students by name or registration number..." class="modern-input">
                <div class="search-hint">
                    <i class="fas fa-info-circle"></i>
                    <span>Type at least 2 characters to search</span>
                </div>
                <div id="searchResults" class="search-results"></div>
            </div>
        </section>

        <!-- Stats Grid -->
        <section class="stats-section">
            <div class="section-header">
                <h2><i class="fas fa-chart-bar"></i> Performance Overview</h2>
                <p class="section-subtitle">Real-time analytics & metrics</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card gradient-1">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Total Students</h3>
                        <div class="stat-number"><%= stats.totalStudents %></div>
                        <p class="stat-desc">Registered in system</p>
                    </div>
                </div>
                
                <div class="stat-card gradient-2">
                    <div class="stat-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Exams Taken</h3>
                        <div class="stat-number"><%= stats.totalExams %></div>
                        <p class="stat-desc">Total exam attempts</p>
                    </div>
                </div>
                
                <div class="stat-card gradient-3">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Exams Passed</h3>
                        <div class="stat-number"><%= stats.passedExams %></div>
                        <p class="stat-desc">Score ≥ 70%</p>
                    </div>
                </div>
                
                <div class="stat-card gradient-4">
                    <div class="stat-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Pass Rate</h3>
                        <div class="stat-number"><%= stats.passRate %>%</div>
                        <p class="stat-desc">Overall success rate</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: <%= stats.passRate %>%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Exam Results -->
        <section class="results-section">
            <div class="section-header">
                <div class="section-title-group">
                    <h2><i class="fas fa-list-alt"></i> Recent Exam Results</h2>
                    <span class="badge"><%= examResults.length %> records</span>
                </div>
                <div class="section-actions">
                    <button class="btn-refresh" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn-refresh" onclick="downloadCurrentTablePDF()" style="background: var(--success);">
                        <i class="fas fa-file-pdf"></i> Export Table
                    </button>
                    <div class="auto-refresh">
                        <i class="fas fa-redo"></i>
                        <span>Auto-refresh: 30s</span>
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="modern-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>
                                <div class="table-header-cell">
                                    <span>Student</span>
                                    <i class="fas fa-sort"></i>
                                </div>
                            </th>
                            <th>Registration</th>
                            <th>Exam</th>
                            <th>Course</th>
                            <th>Score</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (examResults.length > 0) { %>
                            <% examResults.forEach((result, index) => { %>
                                <tr class="table-row <%= index % 2 === 0 ? 'even' : 'odd' %>" data-exam-id="<%= result.exam_id || index %>">
                                    <td>
                                        <a href="/student/<%= encodeURIComponent(result.student_jid) %>" class="student-link">
                                            <div class="student-avatar">
                                                <i class="fas fa-user-circle"></i>
                                            </div>
                                            <div class="student-info">
                                                <strong><%= result.student_name %></strong>
                                                <small>View Profile →</small>
                                            </div>
                                        </a>
                                    </td>
                                    <td>
                                        <code class="reg-number"><%= result.registration_number %></code>
                                    </td>
                                    <td>
                                        <strong><%= result.exam_title %></strong>
                                    </td>
                                    <td>
                                        <span class="course-badge"><%= result.course %></span>
                                    </td>
                                    <td>
                                        <div class="score-container">
                                            <div class="score-circle score-<%= 
                                                result.score >= 70 ? 'high' : 
                                                result.score >= 50 ? 'medium' : 'low'
                                            %>">
                                                <%= result.score %>%
                                            </div>
                                            <div class="score-detail">
                                                (<%= result.correct_answers %>/<%= result.total_questions %>)
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="time-cell">
                                            <i class="far fa-clock"></i>
                                            <%= result.time_taken_minutes %> min
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-<%= result.passed ? 'passed' : 'failed' %>">
                                            <i class="fas <%= result.passed ? 'fa-check' : 'fa-times' %>"></i>
                                            <%= result.passed ? 'PASSED' : 'FAILED' %>
                                        </span>
                                    </td>
                                    <td>
                                        <div class="date-cell">
                                            <%= new Date(result.completed_at).toLocaleDateString('en-US', { 
                                                month: 'short', 
                                                day: 'numeric',
                                                year: 'numeric'
                                            }) %>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="exam-actions">
                                            <button class="btn-download-exam" onclick="downloadSingleExamPDF(this)" data-index="<%= index %>">
                                                <i class="fas fa-file-pdf"></i> PDF
                                            </button>
                                            <% if (result.passed) { %>
                                                <button class="btn-download-exam" onclick="generateStudentCertificate(this)" 
                                                        style="background: var(--warning)" 
                                                        data-student="<%= result.student_name %>"
                                                        data-score="<%= result.score %>"
                                                        data-exam="<%= result.exam_title %>">
                                                    <i class="fas fa-award"></i> Cert
                                                </button>
                                            <% } %>
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="9" class="empty-state">
                                    <div class="empty-content">
                                        <i class="fas fa-clipboard-list" style="font-size: 4em;"></i>
                                        <h3>No exam results yet</h3>
                                        <p>Exam data will appear here as students complete their tests</p>
                                    </div>
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Footer -->
        <footer class="modern-footer">
            <div class="footer-content">
                <div class="footer-left">
                    <div class="footer-logo">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Charles Academy</span>
                    </div>
                    <p class="footer-text">Real-time exam analytics & performance tracking</p>
                </div>
                <div class="footer-right">
                    <div class="footer-links">
                        <a href="#" class="footer-link">
                            <i class="fas fa-question-circle"></i> Help
                        </a>
                        <a href="javascript:void(0)" class="footer-link" onclick="downloadAllResultsPDF()">
                            <i class="fas fa-download"></i> Export All
                        </a>
                        <a href="#" class="footer-link">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                    </div>
                    <p class="footer-update">
                        <i class="fas fa-circle" style="color: #10b981; font-size: 0.8em;"></i>
                        Updated just now • 
                        <a href="/" class="refresh-link">
                            <i class="fas fa-redo"></i> Refresh Now
                        </a>
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <!-- PDF Template Container (hidden) -->
    <div id="pdfTemplate" class="pdf-template">
        <div id="pdfContent" class="exam-pdf-content"></div>
    </div>

    <!-- PDF Loading Overlay -->
    <div id="pdfLoading" class="pdf-loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">Generating PDF...</div>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;

        // Show loading overlay
        function showLoading() {
            document.getElementById('pdfLoading').classList.add('active');
        }

        // Hide loading overlay
        function hideLoading() {
            document.getElementById('pdfLoading').classList.remove('active');
        }

        // Download single exam PDF
        function downloadSingleExamPDF(button) {
            showLoading();
            const index = button.getAttribute('data-index');
            const row = document.querySelector(`tr[data-exam-id="${index}"]`);
            
            // Get data from the row
            const studentName = row.querySelector('.student-info strong').textContent;
            const regNumber = row.querySelector('.reg-number').textContent;
            const examTitle = row.querySelector('td:nth-child(3) strong').textContent;
            const course = row.querySelector('.course-badge').textContent;
            const score = row.querySelector('.score-circle').textContent;
            const timeTaken = row.querySelector('.time-cell').textContent.replace(' min', '');
            const status = row.querySelector('.status-badge').textContent;
            const date = row.querySelector('.date-cell').textContent;
            
            // Create PDF content
            const pdfContent = document.getElementById('pdfContent');
            pdfContent.innerHTML = `
                <div class="pdf-header">
                    <h1>Charles Academy</h1>
                    <h2>Exam Result Report</h2>
                    <p>Official Examination Result Document</p>
                </div>
                
                <div class="pdf-details">
                    <div class="pdf-detail-item">
                        <strong>Student Name:</strong>
                        <span>${studentName}</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Registration Number:</strong>
                        <span>${regNumber}</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Exam Title:</strong>
                        <span>${examTitle}</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Course:</strong>
                        <span>${course}</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Score:</strong>
                        <span>${score}</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Time Taken:</strong>
                        <span>${timeTaken} minutes</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Status:</strong>
                        <span>${status}</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Exam Date:</strong>
                        <span>${date}</span>
                    </div>
                </div>
                
                <div class="pdf-performance">
                    <h3>Performance Analysis</h3>
                    <p>This document certifies that ${studentName} has completed the ${examTitle} examination
                    with a score of ${score}. The student ${status === 'PASSED' ? 'has successfully passed' : 'did not pass'} 
                    the examination requirement of 70% minimum score.</p>
                </div>
                
                <div class="pdf-warning">
                    <strong>Note:</strong> This is an official document. Any alterations invalidate this certificate.
                </div>
                
                <div class="pdf-footer">
                    <p>Generated on: ${new Date().toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</p>
                    <p>Charles Academy • Exam Department • Official Document</p>
                </div>
            `;
            
            // Generate PDF
            setTimeout(() => {
                html2canvas(pdfContent, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png', 1.0);
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 190;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    const positionX = (210 - imgWidth) / 2;
                    const positionY = 10;
                    
                    pdf.addImage(imgData, 'PNG', positionX, positionY, imgWidth, imgHeight);
                    pdf.setProperties({
                        title: `Exam Result - ${studentName}`,
                        subject: 'Exam Result Report',
                        author: 'Charles Academy',
                        keywords: 'exam, result, report, education'
                    });
                    
                    // Add page numbers
                    const totalPages = pdf.internal.getNumberOfPages();
                    for (let i = 1; i <= totalPages; i++) {
                        pdf.setPage(i);
                        pdf.setFontSize(10);
                        pdf.setTextColor(150);
                        pdf.text(
                            `Page ${i} of ${totalPages}`,
                            pdf.internal.pageSize.getWidth() / 2,
                            pdf.internal.pageSize.getHeight() - 10,
                            { align: 'center' }
                        );
                    }
                    
                    pdf.save(`Exam-Result-${studentName.replace(/\s+/g, '-')}-${date.replace(/\s+/g, '-')}.pdf`);
                    hideLoading();
                }).catch(error => {
                    console.error('Error generating PDF:', error);
                    hideLoading();
                    alert('Error generating PDF. Please try again.');
                });
            }, 500);
        }

        // Download all results PDF
        function downloadAllResultsPDF() {
            showLoading();
            
            // Get all table data
            const table = document.getElementById('resultsTable');
            const rows = table.querySelectorAll('tbody tr');
            
            // Create PDF content
            const pdfContent = document.getElementById('pdfContent');
            let tableHTML = '';
            
            rows.forEach((row, index) => {
                if (row.classList.contains('empty-state')) return;
                
                const studentName = row.querySelector('.student-info strong').textContent;
                const regNumber = row.querySelector('.reg-number').textContent;
                const examTitle = row.querySelector('td:nth-child(3) strong').textContent;
                const score = row.querySelector('.score-circle').textContent;
                const status = row.querySelector('.status-badge').textContent;
                const date = row.querySelector('.date-cell').textContent;
                
                tableHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${index + 1}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${studentName}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${regNumber}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${examTitle}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${score}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${status}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${date}</td>
                    </tr>
                `;
            });
            
            pdfContent.innerHTML = `
                <div class="pdf-header">
                    <h1>Charles Academy</h1>
                    <h2>Complete Exam Results Report</h2>
                    <p>All Examination Results - Generated on ${new Date().toLocaleDateString()}</p>
                </div>
                
                <div class="pdf-details">
                    <div class="pdf-detail-item">
                        <strong>Total Students:</strong>
                        <span><%= stats.totalStudents %></span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Exams Taken:</strong>
                        <span><%= stats.totalExams %></span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Pass Rate:</strong>
                        <span><%= stats.passRate %>%</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Generated By:</strong>
                        <span>System Administrator</span>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px;">Exam Results Summary</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 20px;">
                    <thead>
                        <tr style="background: #4361ee; color: white;">
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">#</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Student</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Reg No.</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Exam</th>
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Score</th>
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Status</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableHTML}
                    </tbody>
                </table>
                
                <div class="pdf-footer">
                    <p>Total Records: ${rows.length}</p>
                    <p>Charles Academy • Examination Department</p>
                </div>
            `;
            
            // Generate PDF
            setTimeout(() => {
                html2canvas(pdfContent, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png', 1.0);
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 190;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    const positionX = (210 - imgWidth) / 2;
                    const positionY = 10;
                    
                    pdf.addImage(imgData, 'PNG', positionX, positionY, imgWidth, imgHeight);
                    
                    // Add statistics page
                    pdf.addPage();
                    pdf.setFontSize(20);
                    pdf.setTextColor(67, 97, 238);
                    pdf.text('Performance Statistics', 105, 30, { align: 'center' });
                    
                    pdf.setFontSize(12);
                    pdf.setTextColor(0, 0, 0);
                    pdf.text(`Total Students: <%= stats.totalStudents %>`, 20, 60);
                    pdf.text(`Exams Taken: <%= stats.totalExams %>`, 20, 75);
                    pdf.text(`Exams Passed: <%= stats.passedExams %>`, 20, 90);
                    pdf.text(`Pass Rate: <%= stats.passRate %>%`, 20, 105);
                    
                    pdf.setProperties({
                        title: 'All Exam Results Report',
                        subject: 'Exam Results Summary',
                        author: 'Charles Academy',
                        keywords: 'exam, results, summary, education'
                    });
                    
                    pdf.save(`All-Exam-Results-${new Date().toISOString().split('T')[0]}.pdf`);
                    hideLoading();
                }).catch(error => {
                    console.error('Error generating PDF:', error);
                    hideLoading();
                    alert('Error generating PDF. Please try again.');
                });
            }, 500);
        }

        // Download current table as PDF
        function downloadCurrentTablePDF() {
            showLoading();
            
            html2canvas(document.getElementById('resultsTable'), {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png', 1.0);
                const pdf = new jsPDF('l', 'mm', 'a4'); // Landscape for table
                const imgWidth = 280;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                const positionX = (297 - imgWidth) / 2;
                const positionY = 10;
                
                pdf.addImage(imgData, 'PNG', positionX, positionY, imgWidth, imgHeight);
                pdf.setProperties({
                    title: 'Exam Results Table',
                    subject: 'Exam Results Table Export',
                    author: 'Charles Academy'
                });
                
                pdf.save(`Exam-Results-Table-${new Date().toISOString().split('T')[0]}.pdf`);
                hideLoading();
            }).catch(error => {
                console.error('Error generating PDF:', error);
                hideLoading();
                alert('Error generating PDF. Please try again.');
            });
        }

        // Generate student certificate
        function generateStudentCertificate(button) {
            showLoading();
            
            const studentName = button.getAttribute('data-student');
            const score = button.getAttribute('data-score');
            const examTitle = button.getAttribute('data-exam');
            
            const pdfContent = document.getElementById('pdfContent');
            pdfContent.innerHTML = `
                <div class="pdf-header">
                    <h1 style="color: #d4af37; font-size: 36px;">Charles Academy</h1>
                    <h2 style="color: #4361ee; font-size: 28px;">Certificate of Achievement</h2>
                    <p style="font-size: 18px; color: #6b7280;">This certificate is proudly presented to</p>
                </div>
                
                <div style="text-align: center; margin: 40px 0;">
                    <h3 style="font-size: 32px; color: #1f2937; margin-bottom: 10px; font-weight: 600;">${studentName}</h3>
                    <p style="font-size: 18px; color: #6b7280;">For outstanding performance in</p>
                    <h4 style="font-size: 24px; color: #7209b7; margin: 20px 0; font-weight: 600;">${examTitle}</h4>
                </div>
                
                <div style="text-align: center; margin: 30px 0; padding: 30px; border: 3px solid #d4af37; border-radius: 15px; background: linear-gradient(135deg, #fffdf6 0%, #fff9e6 100%);">
                    <p style="font-size: 18px; margin-bottom: 10px; color: #666;">Achieved a score of</p>
                    <div style="font-size: 64px; color: #10b981; font-weight: bold; margin: 20px 0;">${score}%</div>
                    <p style="font-size: 16px; color: #6b7280; margin-top: 10px;">Excellent Performance</p>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 60px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <div style="text-align: center; flex: 1;">
                        <div style="border-bottom: 2px solid #6b7280; padding-bottom: 10px; margin-bottom: 10px; width: 200px; margin: 0 auto;">
                            <p style="margin: 0; font-size: 14px; color: #666;">Principal's Signature</p>
                        </div>
                        <p style="margin: 0; font-size: 14px; color: #6b7280; font-weight: 600;">Dr. Charles M. Johnson</p>
                    </div>
                    
                    <div style="text-align: center; flex: 1;">
                        <div style="border-bottom: 2px solid #6b7280; padding-bottom: 10px; margin-bottom: 10px; width: 200px; margin: 0 auto;">
                            <p style="margin: 0; font-size: 14px; color: #666;">Exam Coordinator</p>
                        </div>
                        <p style="margin: 0; font-size: 14px; color: #6b7280; font-weight: 600;">Prof. Sarah Williams</p>
                    </div>
                </div>
                
                <div class="pdf-footer">
                    <p>Certificate ID: CERT-${Date.now().toString().slice(-8)}</p>
                    <p>Issued on: ${new Date().toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric'
                    })}</p>
                </div>
            `;
            
            setTimeout(() => {
                html2canvas(pdfContent, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png', 1.0);
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 190;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    const positionX = (210 - imgWidth) / 2;
                    const positionY = 10;
                    
                    pdf.addImage(imgData, 'PNG', positionX, positionY, imgWidth, imgHeight);
                    
                    // Add border decoration
                    pdf.setLineWidth(0.5);
                    pdf.setDrawColor(212, 175, 55);
                    pdf.rect(5, 5, 200, 287);
                    
                    pdf.setProperties({
                        title: `Certificate - ${studentName}`,
                        subject: 'Certificate of Achievement',
                        author: 'Charles Academy',
                        keywords: 'certificate, achievement, award, education'
                    });
                    
                    pdf.save(`Certificate-${studentName.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
                    hideLoading();
                }).catch(error => {
                    console.error('Error generating PDF:', error);
                    hideLoading();
                    alert('Error generating certificate. Please try again.');
                });
            }, 500);
        }

        // Download exam paper PDF
        function downloadExamPaperPDF() {
            showLoading();
            
            // Sample exam questions
            const questions = [
                {
                    question: "What is the main purpose of education according to the passage?",
                    options: [
                        "To gain knowledge and develop skills",
                        "To get a good job only", 
                        "To avoid poverty",
                        "To attend school regularly"
                    ],
                    answer: "To gain knowledge and develop skills"
                },
                {
                    question: "Where can people learn besides school?",
                    options: [
                        "Only from books",
                        "From books, internet, and daily experiences",
                        "Only from teachers",
                        "From television only"
                    ],
                    answer: "From books, internet, and daily experiences"
                },
                {
                    question: "What do schools provide according to the passage?",
                    options: [
                        "Only knowledge",
                        "Guidance, discipline, and structured learning",
                        "Only textbooks",
                        "Internet access only"
                    ],
                    answer: "Guidance, discipline, and structured learning"
                }
            ];
            
            let questionsHTML = '';
            questions.forEach((q, index) => {
                questionsHTML += `
                    <div style="margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #e5e7eb;">
                        <h4 style="color: #1f2937; margin-bottom: 10px; font-size: 16px;">Question ${index + 1}: ${q.question}</h4>
                        <div style="margin-left: 20px;">
                            ${q.options.map((opt, optIndex) => `
                                <div style="margin-bottom: 5px;">
                                    ${String.fromCharCode(65 + optIndex)}) ${opt}
                                </div>
                            `).join('')}
                        </div>
                        <div style="background: #d1fae5; padding: 10px 15px; border-radius: 6px; margin-top: 10px; border-left: 4px solid #10b981;">
                            <strong>Correct Answer:</strong> ${q.answer}
                        </div>
                    </div>
                `;
            });
            
            const pdfContent = document.getElementById('pdfContent');
            pdfContent.innerHTML = `
                <div class="pdf-header">
                    <h1>Charles Academy</h1>
                    <h2>Reading Skills Examination</h2>
                    <p>READING PASSAGE A: The Value of Education</p>
                </div>
                
                <div class="pdf-details">
                    <div class="pdf-detail-item">
                        <strong>Exam Duration:</strong>
                        <span>2 Hours</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Total Marks:</strong>
                        <span>100</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Instructions:</strong>
                        <span>Read all passages carefully before answering</span>
                    </div>
                    <div class="pdf-detail-item">
                        <strong>Date:</strong>
                        <span>${new Date().toLocaleDateString()}</span>
                    </div>
                </div>
                
                <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; border-radius: 6px; margin: 20px 0;">
                    <strong style="color: #92400e;">Important Instructions:</strong><br>
                    • Answer ALL questions.<br>
                    • Each question carries FIVE (5) marks.<br>
                    • Each sub-question carries ONE (1) mark.<br>
                    • Write clear and complete answers.
                </div>
                
                <div style="margin: 30px 0;">
                    <h3 style="color: #1f2937; margin-bottom: 15px;">READING PASSAGE A</h3>
                    <p><strong style="font-size: 18px;">The Value of Education</strong></p>
                    <p style="line-height: 1.8; margin: 10px 0;">Education plays an important role in the life of every person. It helps people gain knowledge, develop skills, and build confidence. An educated person can make better decisions and solve problems more easily.</p>
                    <p style="line-height: 1.8; margin: 10px 0;">Education is not only learned in schools. People learn from books, the internet, and daily experiences. However, schools provide guidance, discipline, and structured learning. Students who attend school regularly usually perform better in their future careers.</p>
                    <p style="line-height: 1.8; margin: 10px 0;">In many countries, education helps reduce poverty and improve living standards. When people are educated, they can find better jobs and support their families. For this reason, education should be encouraged for everyone.</p>
                </div>
                
                <div>
                    <h3 style="color: #1f2937; margin-bottom: 20px;">Questions (Answer all questions)</h3>
                    ${questionsHTML}
                </div>
                
                <div class="pdf-footer">
                    <p style="font-weight: bold; font-size: 14px;">--- END OF EXAM ---</p>
                    <p>Charles Academy • Examination Paper • Do Not Reproduce</p>
                </div>
            `;
            
            setTimeout(() => {
                html2canvas(pdfContent, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png', 1.0);
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 190;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    const positionX = (210 - imgWidth) / 2;
                    const positionY = 10;
                    
                    pdf.addImage(imgData, 'PNG', positionX, positionY, imgWidth, imgHeight);
                    pdf.setProperties({
                        title: 'Reading Skills Examination',
                        subject: 'Exam Paper with Answers',
                        author: 'Charles Academy',
                        keywords: 'exam, questions, reading, skills'
                    });
                    
                    pdf.save(`Reading-Skills-Exam-${new Date().toISOString().split('T')[0]}.pdf`);
                    hideLoading();
                }).catch(error => {
                    console.error('Error generating PDF:', error);
                    hideLoading();
                    alert('Error generating exam paper. Please try again.');
                });
            }, 500);
        }

        // Other PDF generation functions
        function generateResultsPDF() {
            downloadAllResultsPDF();
        }

        function generateCertificatePDF() {
            const rows = document.querySelectorAll('#resultsTable tbody tr');
            let bestStudent = null;
            let bestScore = 0;
            
            rows.forEach(row => {
                if (!row.classList.contains('empty-state')) {
                    const scoreText = row.querySelector('.score-circle').textContent;
                    const score = parseInt(scoreText);
                    if (score > bestScore) {
                        bestScore = score;
                        bestStudent = row;
                    }
                }
            });
            
            if (bestStudent) {
                const button = bestStudent.querySelector('.btn-download-exam[style*="var(--warning)"]');
                if (button) {
                    generateStudentCertificate(button);
                } else {
                    alert('No passed students found for certificate generation.');
                }
            } else {
                alert('No exam results found.');
            }
        }

        function generateQuestionsPDF() {
            downloadExamPaperPDF();
        }

        // Auto-refresh page every 30 seconds
        setTimeout(() => {
            location.reload();
        }, 30000);

        // Search functionality
        let searchTimeout;
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsDiv.innerHTML = '';
                resultsDiv.classList.remove('active');
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const rows = document.querySelectorAll('#resultsTable tbody tr');
                    let matches = [];
                    
                    rows.forEach(row => {
                        if (row.classList.contains('empty-state')) return;
                        
                        const studentName = row.querySelector('.student-info strong').textContent.toLowerCase();
                        const regNumber = row.querySelector('.reg-number').textContent.toLowerCase();
                        
                        if (studentName.includes(query.toLowerCase()) || regNumber.includes(query.toLowerCase())) {
                            matches.push({
                                name: row.querySelector('.student-info strong').textContent,
                                reg: row.querySelector('.reg-number').textContent,
                                row: row
                            });
                        }
                    });
                    
                    resultsDiv.classList.add('active');
                    
                    if (matches.length > 0) {
                        let html = '';
                        matches.forEach((match, index) => {
                            html += `
                                <a href="javascript:void(0)" class="search-result-item" onclick="scrollToRow('${match.reg}')">
                                    <div class="search-avatar">
                                        <i class="fas fa-user-graduate"></i>
                                    </div>
                                    <div class="search-result-info">
                                        <strong>${match.name}</strong>
                                        <span>${match.reg}</span>
                                    </div>
                                    <i class="fas fa-chevron-right"></i>
                                </a>`;
                        });
                        
                        html += `<div class="search-footer">
                            <i class="fas fa-info-circle"></i>
                            <span>${matches.length} students found</span>
                        </div>`;
                        
                        resultsDiv.innerHTML = html;
                    } else {
                        resultsDiv.innerHTML = `
                            <div style="padding: 40px 20px; text-align: center;">
                                <i class="fas fa-search" style="font-size: 3em; color: #9ca3af; margin-bottom: 15px;"></i>
                                <p style="color: #6b7280;">No students found matching "${query}"</p>
                            </div>`;
                    }
                } catch (error) {
                    console.error('Error:', error);
                    resultsDiv.innerHTML = `
                        <div style="padding: 40px 20px; text-align: center;">
                            <i class="fas fa-exclamation-circle" style="font-size: 3em; color: #ef4444; margin-bottom: 15px;"></i>
                            <p style="color: #6b7280;">Search error. Please try again.</p>
                        </div>`;
                }
            }, 300);
        });

        // Close search results when clicking outside
        document.addEventListener('click', (e) => {
            const searchResults = document.getElementById('searchResults');
            const searchInput = document.getElementById('searchInput');
            
            if (!searchResults.contains(e.target) && !searchInput.contains(e.target)) {
                searchResults.classList.remove('active');
            }
        });

        // Scroll to specific row
        function scrollToRow(regNumber) {
            const row = document.querySelector(`.reg-number:contains("${regNumber}")`).closest('tr');
            if (row) {
                row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                row.style.backgroundColor = '#e0e7ff';
                setTimeout(() => {
                    row.style.backgroundColor = '';
                }, 2000);
            }
            document.getElementById('searchResults').classList.remove('active');
        }

        // Add hover effects to table rows
        document.addEventListener('DOMContentLoaded', () => {
            const tableRows = document.querySelectorAll('.table-row');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', () => {
                    row.style.transform = 'translateY(-2px)';
                    row.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                });
                row.addEventListener('mouseleave', () => {
                    row.style.transform = 'translateY(0)';
                    row.style.boxShadow = 'none';
                });
            });
        });

        // Custom contains selector for older browsers
        if (!Element.prototype.matches) {
            Element.prototype.matches = Element.prototype.msMatchesSelector || 
                                      Element.prototype.webkitMatchesSelector;
        }

        if (!Element.prototype.closest) {
            Element.prototype.closest = function(s) {
                var el = this;
                do {
                    if (el.matches(s)) return el;
                    el = el.parentElement || el.parentNode;
                } while (el !== null && el.nodeType === 1);
                return null;
            };
        }
    </script>
</body>
</html>